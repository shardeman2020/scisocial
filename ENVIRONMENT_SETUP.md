# Environment Variables Setup Guide

## Step 1: Create Production Environment Files

### Frontend

```bash
cd frontend
cp .env.production.example .env.production
```

Then edit `.env.production` with these values:

```bash
# Required
NEXT_PUBLIC_API_URL=https://api.scisocial.pro
NEXT_PUBLIC_APP_NAME=SciSocial
NEXT_PUBLIC_ENV=production
NEXT_PUBLIC_BRANDING_URL=https://scisocial.pro

# Features (all true for full functionality)
NEXT_PUBLIC_ENABLE_SEMANTIC_SEARCH=true
NEXT_PUBLIC_ENABLE_HYBRID_SEARCH=true
NEXT_PUBLIC_ENABLE_AI_SUMMARIES=true
NEXT_PUBLIC_ENABLE_WEEKLY_DIGEST=true

# Optional: Add if you have them
# NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
# NEXT_PUBLIC_SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
```

### Backend

```bash
cd backend
cp .env.production.example .env.production
```

Then edit `.env.production` with these values:

```bash
# Environment
NODE_ENV=production
PORT=3001

# REQUIRED: API Keys - You must fill these in!
CROSSREF_API_EMAIL=your-email@example.com
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxx

# REQUIRED: Email Configuration
EMAIL_HOST=smtp.sendgrid.net
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=apikey
EMAIL_PASSWORD=SG.xxxxxxxxxxxxxxxxxxxxxxxx
EMAIL_FROM=noreply@scisocial.pro
EMAIL_FROM_NAME=SciSocial

# CORS (required for frontend to connect)
CORS_ORIGIN=https://scisocial.pro,https://www.scisocial.pro,https://admin.scisocial.pro

# Database - Auto-configured by Render, or set manually:
# DATABASE_HOST=your-db-host
# DATABASE_PORT=5432
# DATABASE_USER=postgres
# DATABASE_PASSWORD=your-secure-password
# DATABASE_NAME=sci_social_prod

# Redis - Auto-configured by Render, or set manually:
# REDIS_HOST=your-redis-host
# REDIS_PORT=6379

# Security - Generate a strong random string!
JWT_SECRET=GENERATE_A_64_CHAR_RANDOM_STRING_HERE
JWT_EXPIRATION=7d

# File Uploads
MAX_FILE_SIZE=52428800
ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/gif,image/webp

# Weekly Digest (Monday 9 AM UTC)
DIGEST_CRON_SCHEDULE=0 9 * * 1

# AI Model
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# Application URLs
FRONTEND_URL=https://scisocial.pro
ADMIN_URL=https://admin.scisocial.pro
BACKEND_URL=https://api.scisocial.pro

# Optional: Cloud Storage (if using S3)
# STORAGE_TYPE=s3
# AWS_ACCESS_KEY_ID=AKIA...
# AWS_SECRET_ACCESS_KEY=...
# AWS_S3_BUCKET=scisocial-uploads-prod
# AWS_S3_REGION=us-east-1
```

## Step 2: Get Required API Keys

### Crossref API (Free)
1. Visit: https://www.crossref.org/documentation/retrieve-metadata/rest-api/
2. Use your email address - no signup required
3. Set `CROSSREF_API_EMAIL=your-email@example.com`

### Anthropic API (Required for AI Summaries)
1. Visit: https://console.anthropic.com/
2. Sign up or log in
3. Go to API Keys section
4. Create new API key
5. Copy the key starting with `sk-ant-api03-...`
6. Set `ANTHROPIC_API_KEY=sk-ant-api03-...`

### SendGrid (or other SMTP for Email)
1. Visit: https://sendgrid.com/ (or use Gmail, Mailgun, etc.)
2. Sign up for free tier
3. Create API key
4. Set:
   ```
   EMAIL_HOST=smtp.sendgrid.net
   EMAIL_USER=apikey
   EMAIL_PASSWORD=SG.your-api-key-here
   ```

**Alternative: Gmail SMTP**
```
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
```
(Generate app password at: https://myaccount.google.com/apppasswords)

## Step 3: Generate JWT Secret

Generate a secure random string for JWT_SECRET:

```bash
# On Mac/Linux:
openssl rand -base64 64

# Or use Node.js:
node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"

# Or online:
# https://www.random.org/strings/
```

Copy the output and set it as `JWT_SECRET`.

## Step 4: Verify Environment Variables

### For Vercel Deployment

After deploying, add environment variables in Vercel dashboard:
1. Go to Project Settings → Environment Variables
2. Add each `NEXT_PUBLIC_*` variable
3. Set environment: Production
4. Redeploy to apply

### For Render Deployment

Environment variables are set in two ways:
1. **Auto-configured:** DATABASE_URL, REDIS_URL (from render.yaml)
2. **Manual:** Add in Render Dashboard → Environment tab:
   - `CROSSREF_API_EMAIL`
   - `ANTHROPIC_API_KEY`
   - `EMAIL_PASSWORD`
   - `JWT_SECRET` (auto-generated by Render, but you can override)

## Step 5: Test Locally (Optional)

Before deploying, test with production environment locally:

```bash
# Backend
cd backend
cp .env.local.test .env
npm run build
npm run start:prod

# Frontend (in new terminal)
cd frontend
cp .env.local.test .env.local
npm run build
npm start
```

Visit: http://localhost:3000

## Troubleshooting

### "CORS Error" in Browser
- Check `CORS_ORIGIN` includes your frontend URL
- Format: `https://scisocial.pro,https://www.scisocial.pro` (no spaces)

### "Database Connection Error"
- If using Render: Wait for database to provision (check Render dashboard)
- If self-hosted: Verify DATABASE_HOST and credentials

### "Email Not Sending"
- Verify SMTP credentials
- Check EMAIL_HOST and port are correct
- For Gmail: Use app password, not regular password

### "AI Summaries Not Working"
- Verify ANTHROPIC_API_KEY is correct
- Check API key starts with `sk-ant-api03-`
- Ensure you have API credits (check Anthropic console)

## Security Checklist

- [ ] JWT_SECRET is random and at least 64 characters
- [ ] Database password is strong (if self-hosted)
- [ ] API keys are kept secret (not in git)
- [ ] CORS_ORIGIN only includes your domains
- [ ] Production .env files are in .gitignore
- [ ] Sensitive env vars use Render/Vercel secrets (not in render.yaml)

## Next Steps

After configuring environment variables:
1. Review `QUICK_DEPLOY.md` for deployment instructions
2. Or run `./deploy.sh` for interactive deployment
3. Follow `DEPLOYMENT_GUIDE.md` for comprehensive guide
